FROM node:alpine

RUN mkdir -p /opt/frontend
WORKDIR /opt/frontend

ADD package.json /opt/frontend
RUN yarn

ARG CLIENT_API_HOSTNAME
ENV CLIENT_API_HOSTNAME=${CLIENT_API_HOSTNAME}
ARG CLIENT_AUTH_HOSTNAME
ENV CLIENT_AUTH_HOSTNAME=${CLIENT_AUTH_HOSTNAME}
ARG CLIENT_AUTH_REALM
ENV CLIENT_AUTH_REALM=${CLIENT_AUTH_REALM}
ARG CLIENT_AUTH_ID
ENV CLIENT_AUTH_ID=${CLIENT_AUTH_ID}

ARG SERVER_API_HOSTNAME
ENV SERVER_API_HOSTNAME=${SERVER_API_HOSTNAME}
ARG SERVER_AUTH_HOSTNAME
ENV SERVER_AUTH_HOSTNAME=${SERVER_AUTH_HOSTNAME}

ARG SERVICE_PORT
ENV SERVICE_PORT=${SERVICE_PORT}

ARG BUILD_LANGUAGE
ENV BUILD_LANGUAGE=${BUILD_LANGUAGE}

ENV RUNNING_ENV="docker"

ADD . .
RUN yarn run build

EXPOSE ${SERVICE_PORT}

CMD ["npm", "run", "start"]
